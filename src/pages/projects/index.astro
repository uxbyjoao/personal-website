---
import { checkAuth } from "@utils";
import { getCollection } from "astro:content";

import NarrowLayout from "@layouts/NarrowLayout.astro";

const cookie = Astro.cookies.get("auth_token").value;
const projects = await getCollection("projects");

const featuredProjects = projects.filter((project) => project.data.featured);
const regularProjects = projects.filter((project) => !project.data.featured);

if (!cookie || !checkAuth(cookie)) {
  return Astro.redirect(`/login?redirect=/projects`);
}
---

<NarrowLayout title="Projects" heading="Projects">
  <div class="flex flex-col gap-7">
    {
      featuredProjects.map((project) => (
        <div class="flex flex-col items-center gap-7 sm:flex-row">
          <div class="aspect-[4/3] w-full rounded-lg bg-red-500 sm:w-2/6 sm:shrink-0" />
          <div class="flex flex-col gap-3">
            <a
              href={`/projects/${project.slug}`}
              class="underlined-link text-2xl text-neutral-900 dark:text-neutral-100"
            >
              {project.data.title}
            </a>
            <p class="text-lg">{project.data.excerpt}</p>
            <div class="flex flex-wrap gap-2">
              {project.data.tags.map((tag) => (
                <span class="rounded bg-blue-500/5 py-1 px-2 text-sm font-medium text-blue-500">
                  #{tag}
                </span>
              ))}
            </div>
          </div>
        </div>
      ))
    }
  </div>
  <div class="mt-12 grid grid-cols-1 gap-7 md:grid-cols-2">
    {
      regularProjects.map((project) => (
        <div class="flex flex-col gap-3 rounded-lg border border-neutral-100 bg-white p-5 dark:border-neutral-700 dark:bg-neutral-800">
          <a
            href={`/projects/${project.slug}`}
            class="underlined-link text-neutral-900 dark:text-neutral-100"
          >
            {project.data.title}
          </a>
          <p class="text-sm">{project.data.excerpt}</p>
          <div class="flex flex-wrap gap-2">
            {project.data.tags.map((tag) => (
              <span class="rounded bg-blue-500/5 py-1 px-2 text-xs font-medium text-blue-500">
                #{tag}
              </span>
            ))}
          </div>
        </div>
      ))
    }
  </div>
</NarrowLayout>
